{"version":3,"sources":["App.js","index.js"],"names":["md","MarkdownIt","eosClient","api_url","rpc","JsonRpc","this","abiCache","retryDelay","maxRetries","getPrevBlock","block","a","blockId","previous","getInfo","head_block_id","getBlock","prevBlock","actions","processBlock","console","log","transactions","forEach","t","trx","transaction","push","wait","ms","Promise","resolve","setTimeout","retry","get_info","get_block","getAbi","account","get_abi","abi","contracts","action","name","ricardian_contract","fun","numRetries","resource","App","state","blocks","totalBlocks","loadData","setState","i","length","className","onClick","Component","BlockEntry","props","value","label","href","Block","handleClick","e","preventDefault","showDetails","populateDetails","renderContract","contract","data","render","Mustache","err","detailsDownloaded","newActions","key","map","dangerouslySetInnerHTML","__html","hideDetailsLink","details","id","timestamp","Blockchain","isLoading","rows","spinner","src","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.7402c392.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport { JsonRpc } from 'eosjs';\nimport Mustache from 'mustache';\nimport MarkdownIt from 'markdown-it';\nconst md = new MarkdownIt();\n\nclass EosClient {\n  api_url = 'https://api.eosnewyork.io';\n  rpc = new JsonRpc(this.api_url);\n  abiCache = {};\n  retryDelay = 1000;\n  maxRetries = 10;\n\n  getPrevBlock = async (block) => {\n    let blockId;\n    if (block) {\n      blockId = block.previous;\n    } else {\n      const { head_block_id } = await this.getInfo();\n      blockId = head_block_id;\n    }\n    let prevBlock = await this.getBlock(blockId);\n    prevBlock.actions = [];\n    this.processBlock(prevBlock);\n    console.log(prevBlock.actions);\n    return prevBlock;\n  }\n\n  processBlock = (block) => {\n    block.actions = [];\n    block.transactions.forEach((t) => {\n      if (typeof t.trx === 'object') {\n        const actions = t.trx.transaction.actions;\n        block.actions.push(...actions);\n      }\n    });\n  };\n\n  wait = (ms) => {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  };\n\n  getInfo = async () => {\n    return this.retry(async () => this.rpc.get_info());\n  };\n\n  getBlock = async (blockId) => {\n    return this.retry(async () => this.rpc.get_block(blockId));\n  };\n\n  getAbi = async (account) => {\n    if (this.abiCache[account]) return this.abiCache[account];\n    const abi = await this.retry(async () => this.rpc.get_abi(account));\n    abi.contracts = {};\n    if (abi.abi) {\n      abi.abi.actions.forEach(action => {\n        abi.contracts[action.name] = action.ricardian_contract;\n      });\n    }\n    this.abiCache[account] = abi;\n    return abi;\n  };\n\n  retry = async (fun) => {\n    let numRetries = 0;\n    let resource;\n    while(!resource && numRetries < this.maxRetries) {\n      try {\n        resource = await fun();\n      } catch(err) {\n        numRetries++;\n        console.log(\"ERROR !!!!!!!!! retry: \" + numRetries);\n        await this.wait(this.retryDelay);\n      }\n    }\n    return resource;\n  };\n\n}\n\nconst eosClient = new EosClient();\n\nclass App extends Component {\n\n  state = {\n    blocks: [],\n  };\n\n  totalBlocks = 10;\n\n  loadData = async () => {\n    let blocks = [];\n    this.setState({ blocks });\n    for (let i = 0; i < this.totalBlocks; i++) {\n      const block = blocks[blocks.length-1];\n      const prevBlock = await eosClient.getPrevBlock(block);\n      blocks = [...blocks, prevBlock];\n      this.setState({ blocks });\n    };\n  }\n\n  componentDidMount() {\n    this.loadData();\n  }\n\n  render() {\n    const { blocks } = this.state;\n    return (\n      <div className=\"container\">\n        <h1 className=\"app-title\">EOSIO Blockchain Browser</h1>\n        <button onClick={this.loadData}>LOAD</button>\n        <Blockchain blocks={blocks} totalBlocks={this.totalBlocks} />\n      </div>\n    )\n  }\n}\n\nfunction BlockEntry(props) {\n  let value = <span className=\"eos-value\">{props.value}</span>;\n  let label = <div className=\"eos-label\">{props.label}:</div>;\n  if (props.onClick) {\n    value = <a href=\"#\" onClick={props.onClick}>{value}</a>;\n    label = <a href=\"#\" onClick={props.onClick}>{label}</a>;\n  }\n  return <div>{label}{value}</div>;\n}\n\nclass Block extends Component {\n  constructor(props) {\n    super(props);\n    const { block } = this.props;\n    this.state = {\n      actions: block.actions,\n      showDetails: false,\n      detailsDownloaded: false,\n    };\n  }\n\n  handleClick = (e) => {\n    e.preventDefault();\n    if (!this.state.showDetails) {\n      this.populateDetails();\n    }\n    this.setState(state => ({ showDetails: !state.showDetails }));\n  };\n\n  renderContract = (contract, data) => {\n    try {\n      return md.render(Mustache.render(contract, data));\n    } catch (err) {\n      console.log('ERROR: failed to render contract');\n      console.log(err);\n      return '';\n    }\n  };\n\n  populateDetails = async () => {\n    if (this.state.detailsDownloaded) return;\n    const { actions } = this.state;\n\n    for (let i = 0; i < actions.length; i++) {\n      const action = actions[i];\n      if (action.contract) continue;\n      const abi = await eosClient.getAbi(action.account);\n      const contract = abi.contracts[action.name];\n      if (contract) {\n        const newActions = [...this.state.actions];\n        newActions[i].contract = this.renderContract(contract, action.data);\n        this.setState({ actions: newActions });\n      }\n    }\n    this.setState({ detailsDownloaded: true });\n  }\n\n  render() {\n    const { block } = this.props;\n    const { showDetails } = this.state;\n    let key = 0;\n    const actions = this.state.actions.map(action => (\n        <div className=\"eos-block\" key={key++} >\n          <BlockEntry label=\"action\"  value={action.name} />\n          <BlockEntry label=\"account\" value={action.account} />\n          <BlockEntry label=\"contract\" />\n          <div dangerouslySetInnerHTML={{__html:action.contract}} />\n        </div>\n    ));\n\n    const hideDetailsLink = (\n      <a href=\"#\" onClick={this.handleClick}>hide actions</a>\n    );\n\n    const details = (\n      <div className=\"eos-details\">\n        {hideDetailsLink}\n        {actions}\n        {hideDetailsLink}\n      </div>\n    );\n\n    return (\n      <div>\n        <div className=\"eos-block\">\n          <BlockEntry label=\"hash\"      value={block.id} />\n          <BlockEntry label=\"timestamp\" value={block.timestamp} />\n          <BlockEntry label=\"actions\"   value={block.actions.length} onClick={this.handleClick} />\n        </div>\n        {showDetails && details}\n        <hr/>\n      </div>\n    );\n  }\n}\n\nclass Blockchain extends Component {\n\n  isLoading = (rows) => {\n    return rows.length < this.props.totalBlocks;\n  }\n\n  render() {\n    const { blocks } = this.props;\n    const rows = blocks.map(block => (\n      <Block block={block} key={block.id} />\n    ));\n\n    const spinner = (\n      <div className=\"spinner-container\">\n        <img className=\"spinner\" src=\"spinner.gif\" />\n      </div>\n    );\n\n    return (\n      <div>\n        <hr/>\n        <div className=\"eos-blockchain\">\n          {rows}\n        </div>\n        {this.isLoading(rows) && spinner}\n      </div>\n    );\n  }\n\n}\n\nexport default App;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport './index.css'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}