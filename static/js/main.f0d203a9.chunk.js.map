{"version":3,"sources":["App.js","index.js"],"names":["md","MarkdownIt","eosClient","apiUrl","rpc","JsonRpc","this","abiCache","retryDelay","maxRetries","getPrevBlock","block","a","blockId","previous","getInfo","info","head_block_id","getBlock","prevBlock","actions","processBlock","transactions","forEach","t","trx","transaction","push","wait","ms","Promise","resolve","setTimeout","retry","get_info","get_block","getAbi","account","get_abi","abi","contracts","action","name","ricardian_contract","fun","numRetries","resource","App","state","blocks","totalBlocks","loadData","setState","i","length","className","type","onClick","PureComponent","BlockEntry","props","label","value","labelElem","valueElem","Block","handleClick","showDetails","populateDetails","renderContract","contract","data","render","Mustache","err","console","log","detailsDownloaded","newActions","key","actionBlocks","map","dangerouslySetInnerHTML","__html","hideDetailsLink","details","id","timestamp","Blockchain","isLoading","rows","spinner","alt","src","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.f0d203a9.chunk.js","sourcesContent":["import React, { PureComponent } from 'react';\nimport { JsonRpc } from 'eosjs';\nimport Mustache from 'mustache';\nimport MarkdownIt from 'markdown-it';\n\nconst md = new MarkdownIt();\n\nclass EosClient {\n  apiUrl = 'https://api.eosnewyork.io';\n\n  rpc = new JsonRpc(this.apiUrl);\n\n  abiCache = {};\n\n  retryDelay = 1000;\n\n  maxRetries = 10;\n\n  getPrevBlock = async (block) => {\n    let blockId;\n    if (block) {\n      blockId = block.previous;\n    } else {\n      const info = await this.getInfo();\n      blockId = info.head_block_id;\n    }\n    const prevBlock = await this.getBlock(blockId);\n    prevBlock.actions = [];\n    this.processBlock(prevBlock);\n    return prevBlock;\n  }\n\n  processBlock = (block) => {\n    block.actions = [];\n    block.transactions.forEach((t) => {\n      if (typeof t.trx === 'object') {\n        const { actions } = t.trx.transaction;\n        block.actions.push(...actions);\n      }\n    });\n  };\n\n  wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\n  getInfo = () => this.retry(() => this.rpc.get_info());\n\n  getBlock = (blockId) => this.retry(() => this.rpc.get_block(blockId));\n\n  getAbi = async (account) => {\n    if (this.abiCache[account]) return this.abiCache[account];\n    const abi = await this.retry(async () => this.rpc.get_abi(account));\n    abi.contracts = {};\n    if (abi.abi) {\n      abi.abi.actions.forEach((action) => {\n        abi.contracts[action.name] = action.ricardian_contract;\n      });\n    }\n    this.abiCache[account] = abi;\n    return abi;\n  };\n\n  retry = async (fun) => {\n    let numRetries = 0;\n    let resource;\n    while (!resource && numRetries < this.maxRetries) {\n      try {\n        resource = await fun();\n      } catch (err) {\n        numRetries++;\n        // console.log(`ERROR !!!!!!!!! retry: ${numRetries}`);\n        await this.wait(this.retryDelay);\n      }\n    }\n    return resource;\n  };\n}\n\nconst eosClient = new EosClient();\n\nclass App extends PureComponent {\n  state = {\n    blocks: [],\n  };\n\n  totalBlocks = 10;\n\n  componentDidMount() {\n    this.loadData();\n  }\n\n  loadData = async () => {\n    let blocks = [];\n    this.setState({ blocks });\n    for (let i = 0; i < this.totalBlocks; i++) {\n      const block = blocks[blocks.length - 1];\n      const prevBlock = await eosClient.getPrevBlock(block);\n      blocks = [...blocks, prevBlock];\n      this.setState({ blocks });\n    }\n  }\n\n  render() {\n    const { blocks } = this.state;\n    return (\n      <div className=\"container\">\n        <h1 className=\"app-title\">EOSIO Blockchain Browser</h1>\n        <button type=\"button\" className=\"button\" onClick={this.loadData}>LOAD</button>\n        <Blockchain blocks={blocks} totalBlocks={this.totalBlocks} />\n      </div>\n    );\n  }\n}\n\nfunction BlockEntry(props) {\n  const { label, value, onClick } = props;\n  let labelElem = (\n    <span className=\"eos-label\">\n      {label}\n      :\n    </span>\n  );\n  let valueElem = (\n    <span className=\"eos-value\">\n      {value}\n    </span>\n  );\n  if (onClick) {\n    labelElem = (\n      <button type=\"button\" className=\"link-button\" onClick={onClick}>\n        {labelElem}\n      </button>\n    );\n    valueElem = (\n      <button type=\"button\" className=\"link-button\" onClick={onClick}>\n        {valueElem}\n      </button>\n    );\n  }\n  return (\n    <div>\n      <div className=\"eos-label\">{labelElem}</div>\n      {valueElem}\n    </div>\n  );\n}\n\nclass Block extends PureComponent {\n  constructor(props) {\n    super(props);\n    const { block } = this.props;\n    this.state = {\n      actions: block.actions,\n      showDetails: false,\n      detailsDownloaded: false,\n    };\n  }\n\n  handleClick = () => {\n    const { showDetails } = this.state;\n    if (!showDetails) {\n      this.populateDetails();\n    }\n    this.setState((state) => ({ showDetails: !state.showDetails }));\n  };\n\n  renderContract = (contract, data) => {\n    try {\n      return md.render(Mustache.render(contract, data));\n    } catch (err) {\n      console.log('ERROR: failed to render contract');\n      console.log(err);\n      return '';\n    }\n  };\n\n  populateDetails = async () => {\n    const { actions, detailsDownloaded } = this.state;\n    if (detailsDownloaded) return;\n\n    for (let i = 0; i < actions.length; i++) {\n      const action = actions[i];\n      if (action.contract) continue;\n      const abi = await eosClient.getAbi(action.account);\n      const contract = abi.contracts[action.name];\n      if (contract) {\n        const newActions = [...actions];\n        newActions[i].contract = this.renderContract(contract, action.data);\n        this.setState({ actions: newActions });\n      }\n    }\n    this.setState({ detailsDownloaded: true });\n  }\n\n  render() {\n    const { block } = this.props;\n    const { actions, showDetails } = this.state;\n    let key = 0;\n    const actionBlocks = actions.map((action) => (\n      /* eslint react/no-danger: \"off\" */\n      <div className=\"eos-block\" key={++key}>\n        <BlockEntry label=\"action\" value={action.name} />\n        <BlockEntry label=\"account\" value={action.account} />\n        <BlockEntry label=\"contract\" />\n        <div dangerouslySetInnerHTML={{ __html: action.contract }} />\n      </div>\n    ));\n\n    const hideDetailsLink = (\n      <button type=\"button\" className=\"link-button\" onClick={this.handleClick}>\n        hide actions\n      </button>\n    );\n\n    const details = (\n      <div className=\"eos-details\">\n        {hideDetailsLink}\n        {actionBlocks}\n        {hideDetailsLink}\n      </div>\n    );\n\n    return (\n      <div>\n        <div className=\"eos-block\">\n          <BlockEntry label=\"hash\" value={block.id} />\n          <BlockEntry label=\"timestamp\" value={block.timestamp} />\n          <BlockEntry label=\"actions\" value={block.actions.length} onClick={this.handleClick} />\n        </div>\n        {showDetails && details}\n        <hr />\n      </div>\n    );\n  }\n}\n\nclass Blockchain extends PureComponent {\n  isLoading = (rows) => {\n    const { totalBlocks } = this.props;\n    return rows.length < totalBlocks;\n  }\n\n  render() {\n    const { blocks } = this.props;\n    const rows = blocks.map((block) => (\n      <Block block={block} key={block.id} />\n    ));\n\n    const spinner = (\n      <div className=\"spinner-container\">\n        <img alt=\"spinner\" className=\"spinner\" src=\"spinner.gif\" />\n      </div>\n    );\n\n    return (\n      <div className=\"eos-blockchain\">\n        <hr />\n        <div>\n          {rows}\n        </div>\n        {this.isLoading(rows) && spinner}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.css';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}